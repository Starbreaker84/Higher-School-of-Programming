### 25. Поток данных в формате передачи сообщений

Мы рассмотрели различные способы кодирования потоков данных между СУБД и процессами. Пока мы делали это в парадигмах REST и RPC (один процесс отправляет запрос к другому процессу по сети и ожидает от него скорейший ответ) и БД (один процесс записывает закодированные данные, а другой читает их когда-нибудь потом, или даже никогда).

В заключение данного курса вкратце рассмотрим **модель асинхронной передачи сообщений (asynchronous message-passing system)** -- нечто среднее между RPC и базами данных. Она схожа с концепцией RPC в том, что запрос от клиента (обычно называемый  **сообщением, message** ) доставляется другому процессу без особо долгой задержки.

Это напоминает СУБД тем, что сообщение не отправляется непосредственно через сетевое соединение, а проходит через посредника, который временно хранит это сообщение.

Посредник именуется так:

- **брокер сообщений (message broker)** , или
- **очередь сообщений (message queue)** , или
- **промежуточное ПО, ориентированное на обработку сообщений (message-oriented middleware)** .


Брокер сообщений имеет несколько преимуществ по сравнению с RPC:

- он выступает в качестве буфера в случае недоступности или перегруженности серверов, а следовательно, повышает надёжность системы;
- он может автоматически отправлять повторные сообщения сбойным процессам, тем самым предотвращая потерю сообщений;
- благодаря брокеру, клиенту/получателю сообщений не требуется знать IP-адрес и номера портов сервера (что особенно удобно в облачной среде, где виртуальные машины часто сменяют друг друга);
- он обеспечивает возможность отправки одного сообщения нескольким клиентам;
- он логически расцепляет отправителя и получателя: отправитель лишь публикует сообщения и не заботится о том, кто их получит.

Однако, в отличие от RPC, подобное взаимодействие чаще всего одностороннее: отправитель обычно не ждёт ответ на свои сообщения. Это  **асинхронный паттерн обмена сообщениями: отправитель не ждёт доставки сообщения, а просто отправляет его и забывает о нём** .


### Брокеры сообщений

Ранее на рынке брокеров сообщений преобладало коммерческое корпоративное «тяжёлое» ПО от компаний TIBCO, IBM (WebSphere) и webMethods. Позднее начали приобретать популярность реализации с открытым кодом (RabbitMQ, ActiveMQ, HornetQ, NATS, Apache Kafka и др.). Они более подробно будут рассмотрены на следующих курсах.

Нюансы модели доставки сообщений зависят от реализации и конфигурации, но в целом брокеры сообщений используются следующим образом:

- конкретный процесс ( **поставщик, producer** ) отправляет сообщение, предназначенное для определенной **очереди (queue)** или  **темы/дискуссии (topic)** ,
- брокер обеспечивает доставку данного сообщения одному или нескольким **потребителям (consumers)** или **подписчикам (subscribers)** этой очереди или темы.
  При этом в одной теме может быть  **много поставщиков и много потребителей сообщений** .


## Брокеры сообщений (задания)

======= 117. Брокер сообщений -- это ...

[ ] синхронная модель передачи сообщений

[ 1] асинхронная модель передачи сообщений

[ ] middleware сервер приложений

[ ] структура данных «очередь»

======= 118. Выберите одно неверное утверждение:

[ ] брокер работает буфером при перегруженности серверов

[ ] брокер развязывает отправителя и получателя

[ ] брокер отправляет повторные сообщения сбойным процессам

[ ]клиенту не требуется знать IP-адрес и номера портов сервера

[ 1]брокер обеспечивает надёжную двустороннюю связь клиентов и серверов

[ ] брокер обеспечивает возможность отправки одного сообщения нескольким клиентам

======= 119. Выберите одно верное утверждение:

[ ] процесс отправляет сообщение определенной теме, а брокер обеспечивает его доставку конкретному подписчику

[1 ] процесс отправляет сообщение определенной теме, а брокер обеспечивает его доставку нескольким подписчикам

[ ] процесс отправляет сообщение множеству тем, а брокер обеспечивает его доставку конкретному подписчику

[ ] процесс отправляет сообщение множеству тем, а брокер обеспечивает его доставку нескольким подписчикам

======= 120. В брокерах используется ...

[ ] формат JSON/XML

[ 1] произвольная модель данных

[ ] мета-формат данных
