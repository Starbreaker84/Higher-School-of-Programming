В каком формате лучше вести журнал, если выбран именно такой вариант реализации базы ключ-значение?

Нередко используется нативный текстовый формат наподобие CSV, однако это далеко не лучший формат для журнала.  **Быстрее и проще использовать двоичный формат журнала** , в котором сначала кодируется в байтах длина строки, а затем -- строка неформатированных данных (при этом не возникает нужды и в сериализации в текст).

Как организовывать удаление записей в журнале? Если требуется удалить ключ и соответствующее ему значение, придётся добавить в файл  **специальную запись об удалении (называемую отметка об удалении, tombstone)** . При слиянии сегментов журнала эта отметка указывает процессу слияния игнорировать все предыдущие значения для удалённого ключа.

При перезапуске базы данных в случае сбоев находящиеся в оперативной памяти хэш-карты теряются. Восстановить хэш-карту сегмента можно, прочитав весь файл сегмента с начала до конца и отмечая в процессе смещение последних значений для каждого ключа. Однако если файлы сегментов велики, это может занять много времени, что сделает перезапуск сервера нагрузочной процедурой. Некоторые СУБД ускоряют восстановление за счет сохранения на диске копий состояния хэш-карт всех сегментов, которые можно загрузить в память достаточно быстро.

Фатальный сбой базы данных может произойти в любую минуту, в том числе и в момент добавления записи в журнал. Образы хэш-карт на диске включают контрольные суммы, что позволяет обнаруживать и игнорировать подобные поврежденные части журналов.

Управление конкурентным доступом: поскольку записи в журнал добавляются в строго последовательном порядке, в обычной реализации используется ровно один поток записи. Сегменты файлов данных допускают только дописывание, в остальных отношениях они неизменяемы, так что их можно читать параллельно в нескольких потоках.


## Журналирование "ключ-значение" (задания)

======= 40. Какой формат файла журнала лучше?

[ 1] двоичный

[ ] текстовый

[ ] смешанный

======= 41. Как эффективно удалять запись в журнале?

[ ] физически удалить и сдвинуть остаток файла

[ 1] добавить метку об удалении, а физически удалить потом

[ ] перезаписать файл заново

======= 42. Какова надёжная защита от сбоев при работе с журжналом?

[ ] делать копии хэш-карты на диск

[ ] делать контрольные суммы хэш-карт

[1 ] перечитать сегменты из файла заново

======= 43. Как организуется одновременный доступ к журналу?

[ ] много потоков на запись, много потоков на чтение

[1 ] один поток на запись, много потоков на чтение

[ ] много потоков на запись, один поток на чтение

[ ] один поток на запись, один поток на чтение
