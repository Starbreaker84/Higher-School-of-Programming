## Секционирование

Проблема 63. Если секционирование выполнено неравномерно, на долю одних секций будет приходиться больше данных или запросов, чем на долю других. Такое секционирование называется  **асимметричным (skewed)** .

Наличие асимметрии существенно снижает эффективность секционирования: в предельном случае вся нагрузка ляжет на одну секцию, так что девять из десяти узлов будут простаивать, а узким местом окажется единственный функционирующий узел.

Секция с непропорционально высокой нагрузкой называется  **горячей точкой (hot spot)** .

Решение. Простейший способ избежать горячих точек -- назначать узлы для записей случайным образом, что приведёт к равномерному распределению данных по узлам.


## Секционирование

Проблема 64. При случайном назначении узлов в ходе чтения будет неизвестно, в каком узле находится конкретный элемент данных, поэтому придётся параллельно опрашивать все узлы.

Решение. Допустим пока, что имеем дело с простой моделью данных "ключ -- значение".

Назначим каждой из секций непрерывный диапазон значений ключа, тогда можно легко определить, в какой секции содержится нужный ключ. Если вдобавок знать, с какими секциями какие узлы соотносятся, то можно выполнить запрос непосредственно к соответствующему узлу.

А в пределах каждой секции ключи можно хранить в отсортированном порядке (помните SS-таблицы и LSM-деревья из предыдущего курса?). Да и сами ключи можно рассматривать как сцеплённый индекс, и извлекать несколько связанных записей одним запросом.


## Секционирование

Проблема 65. В подобной схеме некоторые паттерны доступа всё равно приводят к горячим точкам. Если ключ -- это метка дата/время, то секции соответствуют отрезкам времени (например одна секция на день). В случаях, когда данные записываются в базу по мере получения значений от датчиков, все операции записи будут выполняться в одной секции (сегодняшней), вследствие чего эта секция окажется перегружена.

Решение. Необходимо использовать в качестве первого элемента ключа не метку даты/времени, а нечто иное -- например, идентификатор источника данных (датчика).


## Секционирование

Проблема 66. При необходимости получить значения по нескольким источникам данных (датчикам) в пределах определённого промежутка времени придется выполнять отдельный запрос по нескольким секциям -- по диапазону времени для каждого из идентификаторов датчиков.

Решение. Во многих СУБД, дабы избежать асимметрии и горячих точек, применяют распределения ключей по секциям с помощью хеш-функции. Хорошая хеш-функция получает на вход асимметричные данные и возвращает равномерно распределенные значения.


### Секционирование (задания)

======= 55. Асимметричное секционирование -- это ...

[1 ] на некоторые секции приходится значительно больше нагрузки

[ ] на некоторые узлы приходится значительно больше нагрузки

[ ] на некоторые реплики приходится значительно больше нагрузки

======= 56. При случайном назначении узлов ... (выберите неверное утверждение)

[ ] задаём соотношение секций и узлов

[ ] каждой секции назначим непрерывный диапазон значений ключа

[ 1] используем метку дата/время в качестве ключа

[ ] внутри секций ключи храним в отсортированном порядке

======= 57. Как ни организуй ключи в секциях, в некоторых видах запросов по поддиапазонам всё равно придётся выполнять отдельные запросы к нескольким секциям. Можно распределять ключи по секциям ...

[1 ] с помощью хеш-функции

[ ] случайно

[ ] с метками дата/время
