## Синхронная и асинхронная обработка конфликтов

Пользователь 1 меняет значение (физически -- значение некоторого поля в таблице) с A на B, а пользователь 2 одномоментно меняет это же значение с A на C. Внесённые каждым из них изменения успешно применяются к локальному ведущему узлу соответствующего пользователя.

В базе данных с одним ведущим узлом вторая операция записи будет либо заблокирована (ей придётся ждать завершения первой), либо преждевременно прекращена, так что пользователю придётся её повторить, и конфликта не возникнет.

Проблема 35. В схеме с несколькими ведущими узлами обе операции записи завершаются успешно, а конфликт обнаруживается асинхронно в какой-то более поздний момент времени, когда уже слишком поздно просить пользователя его разрешить.

Решение. Можно сделать обнаружение конфликтов синхронным: ждать прохождения репликации операции записи на все реплики, прежде чем сообщать пользователю об её успешном завершении.


## Синхронная и асинхронная обработка конфликтов

Проблема 36. В синхронном режиме теряется главное преимущество репликации с несколькими ведущими узлами: возможность независимой обработки операций записи каждой репликой.

Решение. Можно просто применить репликацию с одним ведущим узлом или её условную модель. Простейшая стратегия предотвращения конфликтов -- гарантировать, что все операции изменения конкретной записи проходят через один и тот же ведущий узел. Например, если пользователь может редактировать собственные данные, то правильно будет маршрутизировать запросы от конкретного человека всегда на один и тот же ЦОД, и всегда применять ведущий узел в нём для чтения и записи.


## Синхронная и асинхронная обработка конфликтов

Проблема 37. В случае, когда произошел сбой одного из ЦОДов и трафик перенаправляется на другой центр, или сам пользователь переехал в другое место и теперь находится физически ближе к другому ЦОД, приходится менять назначенный для записи ведущий узел.

Решение. В таких ситуациях предотвращение конфликтов не работает, и приходится "как-то" справляться с возможностью конкурентных операций записи на различных ведущих узлах. Хорошего ответа на данную проблему нету.


### Синхронная и асинхронная обработка конфликтов (задания)

======= 31. В схеме с несколькими ведущими узлами несколько операций изменения одного и того же значения могут ошибочно завершиться "успешно"

[ ] асихнронно реплицируем эти операции на все реплики

[ 1] ждём сихнронного прохождения репликации этих операций на все реплики

[ ] прогоняем все операции изменения конкретной записи через один и тот же ведущий узел

======= 32. Простая стратегия предотвращения конфликтов -- ...

[ ] асихнронно реплицируем операции записи на все реплики

[ ] ждём сихнронного прохождения репликации операций записи на все реплики

[ 1] прогоняем все операции изменения конкретной записи через один и тот же ведущий узел
