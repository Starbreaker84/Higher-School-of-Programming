# Практика

Из описания сценария вы узнаете, как создать аналитическую панель в DataLens для визуализации информации из витрины данных в ClickHouse.

Для доступа к данным в DataLens необходимо создать подключение с информацией о параметрах доступа к источнику данных. На базе подключения можно создавать датасеты.

## **Шаг 1**

На главной странице DataLens нажмите **Создать подключение** и выберите тип ClickHouse. Откроется страница с параметрами подключения:

[]()![image](https://pictures.s3.yandex.net/resources/1692_1656314789.png)

*Создание подключения к кластеру ClickHouse из DataLens*

Укажите параметры:

* **Название подключения** может быть произвольным
* **Кластер** , в котором находится источник данных
* **Имя хоста**
* **Имя пользователя**
* **Пароль** пользователя

Включите опцию **Разрешить использование подзапросов в качестве источника** и нажмите  **Проверить подключение** . Если проверка прошла без ошибок, сохраните подключение: в правом верхнем углу нажмите  **Создать** . Теперь у нас есть доступ к источнику данных, на основе которого можно создать датасет.

В правом верхнем углу нажмите  **Создать датасет** .

Перенесите на рабочую область таблицу **ch_store_data** и  **sales_order_grid** . Таблицы автоматически свяжутся:

[]()![image](https://pictures.s3.yandex.net/resources/2443243_1656314771.png)

*Настройка таблиц источников данных*

Для проверки связи нажмите значок между таблицами. Таблицы связаны полем  **store_id** :

[]()![image](https://pictures.s3.yandex.net/resources/418418_1656314839.png)

*Проверка связи между таблицами*

При необходимости связь можно изменить или дополнить, указав еще одну пару полей.

## **Шаг 2**

Скорректируем поля таблиц. В левой части страницы над подключениями нажмите на вкладку  **Поля** . Откроется страница с полями таблиц:

[]()![image](https://code.s3.yandex.net/Free%20courses/YCloud_corp/418418.png)

*Страница с полями таблиц*

Внесите некоторые изменения:

1. Для поля **store_location** и **shipping_location** измените тип данных на **Геоточка**
2. В столбце **Агрегация** для поля **grand_total** выберите  **Сумма** .
3. Продублируйте поле  **entity_id** . Нажмите на значок и выберите **Продублировать:**
   * Переименуйте дубликат в  **store_orders** : нажмите имя строки, удалите текущее имя и введите новое.
   * В столбце **Агрегация** для поля **store_orders** выберите  **Количество уникальных** .
4. Аналогично шагу 3 продублируйте поле  **customer_id** , переименуйте дубликат в **store_customer** и выберите **Количество уникальных** в столбце  **Агрегация** .

В правом верхнем углу нажмите  **Создать** , чтобы указать имя датасета и сохранить его. Всё готово для визуализации данных с помощью чартов.

## **Шаг 3**

Для примера нам понадобится два типа чартов:

* **Карта** , на которой отобразим точки магазинов и заказов.
* **Диаграмма с областями** , которая будет показывать динамику отгрузок.

В правом верхнем углу нажмите  **Создать чарт** . Выберите тип чарта  **Карта** :

[]()![image](https://code.s3.yandex.net/Free%20courses/YCloud_corp/520520.png)

*Добавление карты в отчеты*

В списке слоев переименуйте **Слой 1** в  **Магазины** : выберите слой, затем значок `...` и нажмите  **Переименовать** .

* На слое **Магазины** будем отображать точки магазинов. Для этого добавьте измерение **store_location** в секцию  **Геоточки** .
* Добавьте измерение **grand_total** в секцию  **Цвета** . Цвет точки будет зависеть от суммы оборота.
* Добавьте показатель **store_orders** в секцию  **Размер** .  Чем больше заказов у точки, тем больше по размеру она будет.
* Чтобы получить подробную информацию о точке, добавьте измерение **store_name** и показатели  **store_customer** , **store_orders** и **grand_total** в секцию  **Тултипы** . Информация тултипа будет отображаться при наведении указателя на точку:

[]()![image](https://code.s3.yandex.net/Free%20courses/YCloud_corp/612615.png)

*Добавленный на карту тултип*

## **Шаг 4**

Создадим новый слой, на котором будут отображаться точки заказов. Справа от слоя нажмите значок “+”, чтобы добавить новый слой. Переименуйте его в  **Заказы** . Чтобы отобразить точки заказов, добавьте измерение **shipping_location** в секцию  **Геоточки** .

Точек заказов достаточно много, поэтому будет удобно отслеживать количество заказов с помощью тепловой карты. Нажмите на секцию **Геоточки** и выберите  **Геоточки (тепловая карта)** :

[]()![image](https://code.s3.yandex.net/Free%20courses/YCloud_corp/7912.png)

*Тепловая карта с количеством заказов*

Для возможности фильтровать чарт по временному периоду добавьте измерение **created_at** в секцию  **Общие фильтры** . В открывшемся окне выберите пресет **Последние 365 дней** и нажмите  **Применить фильтр** .

Первый чарт готов. В правом верхнем углу нажмите  **Сохранить** , чтобы указать имя чарта и сохранить его.

## **Шаг 5**

Создадим второй чарт для динамики отгрузок:

* Измените тип текущего чарта на  **Диаграмма с областями** .
* Добавьте измерение **created_at** в секцию  **X** . По горизонтали будут отображаться даты отгрузки.
* Добавьте показатель **store_orders** в секцию  **Y** . По вертикали будет отображаться количество заказов.
* Добавьте измерение **store_name** в секцию  **Цвета** . График каждого магазина будет выделен своим цветом.

[]()![image](https://code.s3.yandex.net/Free%20courses/YCloud_corp/8811.png)

*Отчет с динамикой отгрузок*

В верхнем правом углу нажмите значок галочки рядом с кнопкой **Сохранить** и выберите  **Сохранить как** . В открывшемся окне укажите имя нового чарта и нажмите кнопку  **Сохранить** .

## **Шаг 6**

Для более удобного анализа информации сведем ее к единому дашборду. Дашборд — это страница, которая позволяет собрать в одном месте чарты, добавить к ним подписи, заголовки и селекторы.

* Перейдите на главную страницу DataLens: в левом верхнем углу нажмите **Yandex**  **DataLens** .
* Нажмите  **Создать дашборд** .
* Укажите имя дашборда и нажмите  **Создать** .
* В правом верхнем углу нажмите **Добавить** и выберите  **Чарт** .
* В открывшемся окне нажмите **Выбрать** и выберите один из ранее созданных чартов. При необходимости добавьте описание и измените заголовок, который будет отображаться на дашборде.
* Когда все готово, нажмите  **Добавить** . Аналогичным образом добавьте второй чарт.

[]()![image](https://code.s3.yandex.net/Free%20courses/YCloud_corp/9712.png)

*Настройка дашборда: связываем два чарта*

Расположите чарты на дашборде в удобном порядке. Размер чарта можно изменить, удерживая его за правый нижний угол. Нажмите **Сохранить в** правом верхнем углу и убедитесь в корректном отображении аналитической панели и работе фильтров.

[]()![image](https://code.s3.yandex.net/Free%20courses/YCloud_corp/1061.png)

*Готовый дашборд с отчетами*

---

На этом наш курс завершен! У вас есть возможность сдать свой дашборд на проверку, чтобы получить обратную связь от нашей команды или миновать этот шаг и сразу перейти к заключению.
