## 6. Функциональные выражения с шаблонами

**6.1. Сопоставление с образцом внутри функции**

Функция нередко представляется как набор вариантов (клауз) выбора: происходит сопоставление значения с вариантами (классическое название -- сопоставление с образцом, pattern matching).

Функция, поддерживающая варианты выбора, начинается с ключевого слова function.

Варианты разделяются символом |, за которым задаётся проверяемый шаблон, и затем через символы -> соответствующее ему значение результата.

Например, следующая анонимная функция, получив на вход аргумент, проверит его на равенство одной из трёх строк, и при наличии совпадения вернёт подходящее число (её тип string -> int).

```
function 
 | "null"  -> 0
 | "plus"  -> +1
 | "minus" -> -1

let text2int = function 
 | "null"  -> 0
 | "plus"  -> +1
 | "minus" -> -1

printfn "%d" (text2int "plus") // 1
```

**6.2. Универсальный паттерн и or-паттерн**

Корректная функция должна всегда возвращать какое-то значение, поэтому рекомендуется использовать универсальный паттерн _ (символ подчёркивания), который срабатывает, если ни один из предыдущих вариантов не подошёл.

```
function 
 | "null"  -> 0
 | "plus"  -> +1
 | "minus" -> -1
 | _  -> 100
```

Если одному результату требуется сопоставить множество вариантов, используется or-паттерн, когда варианты перечисляются через | сразу друг за другом.

```
function 
 | "null"  -> 0
 | "plus"  -> +1
 | "minus" -> -1
 | "2"|"two"|"dva" -> 2
 | _       -> 100
```

**6.3. Идентификаторы в качестве шаблонов**

В качестве вариантов можно указывать идентификаторы (имена, локальные внутри функции), которые автоматически свяжутся с проверяемым значением.

```
let mul2 = function 
 | 0  -> 1
 | n  -> n * 2

printfn "%d" (mul2 32) // 64
```

Порядок клауз имеет значение.

В следующем примере первым всегда будет срабатывать первый вариант.

```
let mul2 = function 
 | n  -> n * 2
 | 0  -> 1

// warning: This rule will never be matched
```

Идентификаторы, ранее связанные в программе со значениями с помощью let, не могут использоваться в паттернах вариантов внутри функций.

**6.4. Универсальное сопоставление с образцом**

Сопоставление с образцом (сопоставление значения с вариантами или шаблонами) поддерживается в F# также и как отдельная операция match.

```
match n with 
 | 0  -> 1
 | n  -> n * 2

let mul2 n = match n with 
 | 0  -> 1
 | n  -> n * 2

printfn "%d" (mul2 12) // 24
```

В клаузах внутри сопоставления допускается указывать дополнительные логические условия после ключевого слова when (так называемые сторожа).

```
let mul2 n = match n with 
 | 0  -> 1
 | n when n < 10 -> n * 2 
 | n  -> n * 10

printfn "%d" (mul2 12) // 120
```

**6.5. Задание**

Напишите функцию, использующую сопоставление с образцом, которая получает на вход номер месяца (1-январь .. 12-декабрь) и возвращает целое число -- количество дней в нём, или 0, если номер месяца некорректный.

Шаблон для отправки на сервер:

```
let days_in_month = function 
...
```

**[[ предыдущее ]](https://skillsmart.ru/fp/fsh/s44dd232ac.html)**

---

**Ответы на задания 5.5**

```
let g n = n + 5 // int -> int

let gg = fun n -> n + 5

let h (x, y) = System.Math.Sqrt ((x*x)+(y*y))
```
