## 10. Языки запросов к базам данных

### 10.1. SQL

Одним из новшеств реляционной модели в своё время стал новый способ запроса данных:  **SQL -- декларативный язык запросов** , в то время как IMS и CODASYL используют для выполнения запросов императивный код.Например, использование декларативных CSS-стилей в браузере намного удобнее императивного управления стилями с помощью JavaScript. Аналогично в базах данных декларативные языки запросов наподобие SQL оказываются намного более удобными, нежели императивные API запросов.

В декларативных языках запросов, таких как SQL или реляционная алгебра, требуется обязательно описать **шаблон ожидаемых данных** -- каким условиям должны соответствовать результаты и как данные должны быть преобразованы (например, отсортированы, сгруппированы и агрегированы). Однако  **как добиться этого, SQL никак не специфицирует** . Решение о том, какие индексы и методы соединения использовать и в каком порядке выполнять различные части запроса, принимает оптимизатор запросов СУБД.

Декларативные языки часто хорошо подходят для параллельного выполнения, поскольку они задают лишь шаблон результатов, а не используемый для их получения алгоритм.

### 10.2. Выполнение запросов с помощью MapReduce

**MapReduce** – особая модель программирования для обработки больших объемов данных (Big Data) отдельными блоками на множестве машин.

MapReduce – это не декларативный язык запросов и не императивный API запросов. Это нечто среднее:  **логика запроса выражается с помощью фрагментов кода, многократно вызываемых прикладным фреймворком Big Data** . Запрос основывается на функциях map (известной также под названием collect) и reduce (либо иначе fold или inject), существующих во многих функциональных языках программирования.

**Map, примитивно говоря – это применение некоторой унарной (с одним аргументом) функции к каждому элементу набора без изменения его структуры** . Например, есть функция f(x), умножающая x на 5, и список [1,2,3]. Тогда вызов map([1,2,3], f) вернёт результат [5,10,15]. Функция f() была применена к каждому элементу списка (в идеале, параллельно/одновременно).

**Reduce – это по сути операция агрегации, выдающая некоторое интегрированное значение над всеми значенями набора** . Она получает на вход список и бинарную функцию, подразумевающую два аргумента. Например, reduce([1,2,3], "+") = 6. Операция "+" как бы "вставляется" между всеми элементами списка, и вычисляется итоговый результат: 1 + 2 + 3 = 6.
Reduce также потенциально допускает паралельное вычисление -- например, список можно разбить на два, и редуцировать каждый из них независимо, и так далее рекурсивно.

Функции, применяемые MapReduce, должны быть чистыми (pure), то есть могут использовать только передаваемые в них входные данные, но не могут выполнять дополнительные запросы к БД или любой другой ввод-вывод, не должны использовать глобальные по отношению к ним значения и не должны иметь каких-либо побочных эффектов. Указанные ограничения позволяют СУБД выполнять эти функции где угодно и в любом порядке и запускать их повторно в случае неудачи.

MapReduce -- модель программирования низкого уровня, предназначенная прежде всего для распределенных вычислений на кластерах машин. Языки запросов более высокого уровня, такие как SQL, можно реализовать в виде конвейера операций MapReduce.

Один из минусов использования MapReduce в том, что приходится создавать тщательно согласованные чистые функции, что обычно сложнее, чем написать отдельный запрос. Кроме того, декларативные языки запросов в отличие от MapReduce обычно дают оптимизатору запросов существенно больше свободы по улучшению производительности запроса.


## Языки запросов к базам данных (задания)

======= 29. Реляционная алгебра -- это фактически...

[ ] императивный язык

[ 1] декларативный язык

[ ] SQL

[ ] CODASYL

======= 30. Большой плюс декларативного языка

[1 ] автоматическая оптимизация выполнения запроса

[ ] возможность задать шаблон ожидаемых данных

[ ] поддержка параллельного выполнения

======= 31. MapReduce -- это...

[ ] императивная модель

[ ] функциональная модель

[ 1] map + reduce

[ ] декларативная модель
