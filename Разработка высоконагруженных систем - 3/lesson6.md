## "Грязные" операции чтения и записи

Проблема 22. Пусть транзакция записала какие-то данные в базу, но она ещё не была успешно зафиксирована, или же впоследствии была прервана. Может ли другая транзакция видеть эти промежуточные, незафиксированные данные? Операция чтения, возвращающая такие промежуточные данные, называется  **"грязной" (dirty read)** , и в общем случае может выдавать клиентам некорректную информацию.

Решение. Обеспечить самый базовый уровень гарантии изоляции транзакций -- чтение только успешно зафиксированных другими транзакциями данных (никаких "грязных" операций чтения).

Транзакции, выполняемые на этом уровне изоляции  **read committed (чтение зафиксированных данных)** , должны предотвращать "грязные" операции чтения: любые операции записи, выполняемые транзакцией, становятся видны другим транзакциям только после успешной фиксации данной транзакции (становятся видимы результаты сразу всех её операций записи).

## "Грязные" операции чтения и записи

Проблема 23. В пока ещё незавершённой транзакции выполняется операция записи, и через некоторое время более поздняя транзакция перезаписывает незафиксированное значение. Такие операции называются  **"грязными" операциями записи** . Как быть, когда завершится первая транзакция? Что делать, если более поздняя транзакция будет прервана?

Решение. При операциях записи допускается перезаписывать только успешно зафиксированные данные ("грязные" операции записи не допускаются).

Транзакции предотвращают такие операции путём откладывания второй операции записи до того момента, когда транзакция первой операции будет либо успешно зафиксирована, либо прервана.

Поддержка чтения только успешно зафиксированных данных -- очень популярный уровень изоляции, использующийся по умолчанию в Oracle, PostgreSQL, SQL Server и многих других СУБД. Чаще всего эта схема реализуется в виде  **блокировки** : прежде чем модифицировать конкретную строку (или документ), транзакция должна сначала установить блокировку на этот объект, которая будет удерживаться вплоть до успешной фиксации или прерывания транзакции. Удерживать блокировку на конкретный объект может только одна конкретная транзакция; всем остальным транзакциям, желающей выполнить операцию записи в этот объект, придется дождаться фиксации или прерывания первой транзакции (снятия блокировки).

С помощью блокировок можно предотвратить также и "грязные" операции чтения: потребовать, чтобы транзакции, желающие прочитать объект, устанавливали на него блокировку, и освобождали её сразу после чтения.

## "Грязные" операции чтения и записи

Проблема 24. В практике использования блокировок часто возникают ситуации, когда множеству транзакций, выполняющих только чтение, приходится ждать завершения одной длительной транзакции.

Решение. Сегодня большинство СУБД предотвращают "грязные" операции чтения так: запоминают для каждого записываемого в базу объекта и старое (успешно зафиксированное) значение, и новое -- задаваемое транзакцией, которая в данный момент установила блокировку записи. Во время выполнения этой транзакции всем другим транзакциям, читающим объект, просто возвращается старое значение. Только после фиксации нового значения сторонние транзакции начинают получать его при чтении.

### Сериализуемая изоляция транзакций (задания)

======= 17. Конкурентный доступ возникает, когда ... (выберите неверный вариант)

[ 1] транзакции читают одни и те же данные, мешая друг другу

[ ] одна транзакция читает данные, модифицируемые в этот момент другой транзакцией

[ ] две (минимум) транзакции пытаются одновременно модифицировать одни и те же данные

======= 18. Транзакционная сериализуемая изоляция подразумевает ...

[1] как будто транзакции выполняются последовательно

[ ] как будто транзакции выполняются недетерминировано

[] изоляцию транзакций, пытающихся одновременно модифицировать одни и те же данные
