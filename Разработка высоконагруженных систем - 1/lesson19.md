### 17. in-memory databases

Многие наборы данных бывают относительно невелики, так что вполне допустимо держать их полностью в оперативной памяти (возможно, распределённой по нескольким машинам). В этой концепции были разработаны  **БД, размещаемые в оперативной памяти (in-memory databases)** .

Некоторые подобные хранилища «ключ — значение» (например, Memcached) используют кэш, только когда допустимы потери данных в случае перезагрузки машины. Но другие БД, размещаемые в оперативной памяти, стремятся обеспечить полноценную сохраняемость, что достигается с помощью:

- специального аппаратного обеспечения (например, оперативной памяти, питающейся от аккумуляторов),
- записи на диск журналов изменений,
- периодической записи на диск копий состояния,
- путем репликации состояния оперативной памяти на другие машины.

При перезапуске размещаемой в оперативной памяти базы данных необходимо заново загрузить состояние с диска или из реплики по сети (если не используется специальное аппаратное обеспечение). Несмотря на запись данных на диск, она всё равно остается БД, размещаемой в оперативной памяти. Диск используется только в качестве дописываемого журнала с целью обеспечить сохраняемость, а операции чтения выполняются только из оперативной памяти. У записи на диск есть и эксплуатационные преимущества: создавать резервные копии файлов на диске легче, как и проверять их и анализировать с помощью внешних утилит.

Парадоксально, но тот факт, что СУБД в памяти не нужно читать с диска, не даёт им преимущества в производительности перед классическими БД. Дело в том, что современным дисковым подсистемам хранения может никогда не понадобиться читать с диска, если на сервере достаточно оперативной памяти, поскольку ОС все равно кэширует недавно прочитанные блоки диска в памяти. Такие СУБД работают быстрее скорее потому, что способны избежать накладных расходов по кодированию располагаемых в памяти структур данных в формат, в котором они могли бы быть записаны на диск.

Помимо производительности, еще одно интересное преимущество располагаемых в памяти БД состоит в предоставлении моделей данных, которые сложно реализовать с помощью дисковых индексов. Например, Redis обеспечивает интерфейс для различных структур данных, таких как очереди по приоритету и множества, который напоминает БД. Вся информация хранится в оперативной памяти, и реализация такого интерфейса довольно проста.

Архитектура размещаемых в памяти БД также бывает расширяема, чтобы поддерживать наборы данных, превышающие размер доступной памяти, но без возвращения к накладным расходам дискоцентрической архитектуры. Так называемый **подход антикэширования** работает за счёт вытеснения наиболее давно использовавшихся данных из памяти на диск при отсутствии достаточного количества доступной памяти, и загрузки их обратно в оперативную память при обращении в будущем. Операционные системы похожим образом работают с виртуальной памятью и файлами подкачки, но БД может управлять памятью эффективнее, чем ОС -- за счет манипуляций на уровне отдельных записей, а не целых страниц памяти. Однако при таком подходе всё равно необходимо, чтобы индексы полностью помещались в оперативной памяти.


## in-memory databases (задания)

======= 61. Полноценная СУБД в памяти -- это ...

[ ] всё на диске, в память подгружаются страницы

[ 1] все наборы и индексы целиком в ОЗУ

[ ] в ОЗУ только наборы данных

[ ] в ОЗУ только индексы

======= 62. Для защиты СУБД в памяти от сбоев применяется ...
(выберите лишний пункт)

[ ] специальное аппаратное обеспечение

[ ] запись на диск журналов изменений

[ 1] загрузка реплики всей базы с диска

[ ] периодическая запись на диск копий состояния

[ ] репликация состояния ОЗУ на другие машины

======= 63. СУБД в памяти быстрее, потому что ...

[ ] запись в память быстрее, чем на диск

[ ] считывание в память быстрее, чем с диска

[1 ] нету сериализации в дисковый формат

[ ] нету сериализации в формат в ОЗУ
