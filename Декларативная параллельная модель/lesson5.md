### Отказы и сбои

**Отказ/сбой (failure)**

Отказ -- это ненормальное завершение декларативной программы, которое происходит, когда мы пытаемся записать в хранилище противоречивую информацию. Например, если мы пытаемся связать переменную X и с 1, и с 2.

Отказ -- это ситуация "всё или ничего". Если в декларативной параллельной программе возникает отказ для заданного набора входных значений, то все возможные выполнения этой программы с такими входами приведут к отказу (в противном случае выход не получался бы математической функцией от входных данных, когда одни выполнения приводят к неудаче, а другие нет).

Например, есть три нити:

```
X = 1
Y = 2
X = Y
```

Независимо от порядка их выполнения отказ возникнет всегда.

Большинство сбоев связано с ошибками программистов (как в этом примере). Получается весьма радикально, хотя и весьма типично: прервать всю программу из-за одной ошибки программиста. Нередко вместо завершения желательно продолжить выполнение -- например, чтобы просто сообщить о факте ошибки с какой-то уточняющей диагностической информацией. Естественный способ сделать это -- использовать исключения. Содержимое хранилища в такой ситуации будет таким, каким оно было непосредственно перед сбоем.

Однако важно понимать, что выполнение программы после обработки исключения уже не будет декларативным! Потому, что содержимое хранилища не всегда будет одинаковым во всех вариантах исполнения. В приведенном выше примере -- непосредственно перед тем, как произойдет сбой, есть три варианта значений X и Y: 1 и 1, 2 и 2, 1 и 2. Если программа продолжит выполнение, мы сможем наблюдать разные варианты этих значений -- это наблюдаемый недетерминизм. В таких случаях говорят, что мы вышли из декларативной модели (в некоторую более общую).


### Отказы и сбои

**Ограничения при сбое**

Если мы хотим, чтобы после сбоя выполнение снова стало декларативным, то мы должны скрыть явный недетерминизм. Это тоже ответственность программиста.

В нашем примере, если X и Y видны в остальной части программы, то при возникновении исключения надо связать X и Y с некоторыми значениям по умолчанию для такого случая. Если же исключения не будет, то они связываются, как и раньше. Для этого, например, в нитях используются не сами X и Y, а локальные X1 и Y2, которые в итоге и связываются с X и Y в случае корректного выполнения, а в случае сбоя в X и Y заносятся некоторые значения для продолжения дальнейшей работы программы после ошибки.


### 5. Декларативная параллельная модель, управляемая данными

======= 12. Результат работы параллельной декларативной программы -- это ...

[ ] результат последнего шага вычислений

[ ] связывание результата с dataflow-переменными

[ 1] математическая функция от входов программы

======= 13. Частичное прекращение подразумевает ...

[ ] конечное по времени ожидание связывания

[ 1] потенциально бесконечно долгое ожидание связывания

[ ] переключение между нитями

======= 14. Логическая эквивалентность подразумевает "одинаковость" результата параллельной программы ...

[1] для внешнего наблюдателя

[] на уровне реализации
