### Точка пересечения

45. Проблема. В систему требуется ввести новое свойство, но оказывается, что для этого придется видоизменить несколько (допустим, три-пять) тесно связанных классов, и для подготовки каждого из них к тестированию потребуется по два часа рабочего времени. Код после это конечно станет лучше, но следует ли разрывать все без исключения зависимости по отдельности?

Решение. it depends... В общем случае, такие ситуации следует начинать покрывать тестами более высокого уровня -- не по отдельным классам, а по абстракциям, объединяющим их вместе (см. "44 правильных вопроса при разбирательстве с легаси"). Иногда им вообще отдают полное предпочтение вместо мелкоструктурной проверки каждого класса, но правильный подход, когда модульные тесты становятся следствием более "высоких" тестов, когда понятно, что и как именно лучше тестировать на низком уровне.

### Точка пересечения

Точка пересечения -- это такое место в программе, где выявлено воздействие, связанное с точкой конкретного изменения.

46. Проблема. Точки пересечения целесообразно всегда выбирать рядом с точками внесения изменений, однако это не всегда возможно. Чем дальше друг от друга точки пересечения и внесения изменения, тем больше логических шагов в прослеживании связей между ними, и тем труднее убеждаться в их действительной связи и покрывать правильными тестами.

Решение. Если таких логических шагов больше 1-2, то самым надёжным способом будет написание тестов в точке пересечения с последующим возвратом к точке внесения изменений, где вносим небольшие изменения и проверяем, проходит ли тест в точке "следствия" нормально.

Довольно часто лучшей точкой пересечения для одного конкретного изменения оказывается public-метод в изменяемом классе -- он легко выявляется и тестируется.

### Точка сужения

47. Проблема. По вышеприведённой схеме приходится покрывать тестами много отдельных методов -- каждый под своё изменение, если точек изменений напрашивается много. Но мы хотели бы более продуктивно разобраться с ситуацией, когда в некоторой подсистеме требуется внести много изменений, но не желательно разрывать все без исключения зависимости со всеми классами, имеющими к этим изменениям отношение.

Решение. Попробовать найти **точку сужения** -- такое место в коде, где можно написать тесты, которые покроют сразу обширное множество изменений. Нам придётся разрывать меньше зависимостей, и при этом получится контролировать крупный фрагмент кода. Вдобавок, при наличии тестов, характеризующих соответствующую группу классов, будет проще выполнять рефакторинг кода, понимая, как он устроен и как работает.

Но в отношении точек сужения следует помнить: они всегда определяются точками внесения изменений, а не точками пересечения, на которые эти изменения влияют.

### Точка сужения

Что на самом деле представляет собой точка сужения? Как правило, это естественная граница инкапсуляции. По сути, найдя точку сужения, мы обнаруживаем узкий канал, по которому распространяются многие (или даже все) воздействия в крупном фрагменте кода, влияя на состояния других компонентов. Покрыв тестами точку сужения, вы создаёте небольшой оазис, где вам легко и безопасно работать с кодом. Вы можете свободно его реорганизовывать, и постепенно переходить к модульным тестам для каждого отдельного класса.

48. Проблема. Когда мы пишем модульные тесты для конкретного класса, приходится создавать экземпляры взаимодействующих с ним объектов, передавать их экземпляру данного класса, и тестировать состояние этого объекта (а нередко, и других), чтобы убедиться, что вся эта совокупность объектов хорошо взаимодействует и правильно функционирует. Однако если мы делаем это слишком часто, то юнит-тесты медленно разрастаются до масштаба комплексных испытаний чуть ли не всей системы в миниатюре, получаются крупными, массивными и бесконечно долго выполняющимися.

Решение. Чётко разделяйте тесты для точки сужения, и юнит-тесты, и внимательно следите за этим разделением.

### Точки пересечения и сужения (задания)

======= 39. В точке пересечения выявлено воздействие, связанное с...

[ ] конкретным изменением тут же

[ ] точкой сужения

[1 ] конкретным изменением где-то в другом месте

======= 40. Точка сужения -- это ...

[ ] точка для покрытия юнит-тестами

[ ] то, что определяется точкой пересечения

[1 ] естественная граница инкапсуляции

======= 41. В точке сужения ...

[ 1] можно покрыть тестами сразу множество изменений

[ ] можно покрыть тестами одну точку пересечения

[ ] можно покрыть тестами одну точку изменения
