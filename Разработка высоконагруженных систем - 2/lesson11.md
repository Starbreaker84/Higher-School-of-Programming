## Репликация с несколькими ведущими узлами

Проблема 31. Если подключение к единственному ведущему узлу невозможно (например, из-за сбоя сети), то и запись в базу данных выполнить не получится, так как все операции записи проходят через него.

Решение. Напрашивается расширение модели репликации -- разрешить приём запросов на запись нескольким ведущим узлам:  **multi-leader replication** ; репликация "главный — главный" (master-master), репликация "активный/активный" (active/active replication). Каждый из ведущих узлов при этом одновременно работает как ведомый для других ведущих.

## Репликация с несколькими ведущими узлами

Проблема 32. Если репликация с несколькими ведущими узлами реализована в пределах одного ЦОДа, то выгоды от неё фактически теряются из-за излишнего усложнения системы.

Решение. Один ведущий узел размещается в каждом из используемых ЦОДов. Внутри каждого ЦОДа используется обычная репликация "ведущий-ведомый". Ведущий узел каждого ЦОДа реплицирует свои изменения ведущим узлам в других ЦОДах.

## Репликация с несколькими ведущими узлами

Проблема 33. Одни и те же данные могут одновременно модифицироваться в двух различных ЦОДах, и возникают конфликты записи -- например, при использовании автоматически увеличиваемых ключей, триггеров и т. п.

Решение. Репликация с несколькими ведущими узлами обычно считается опасной вещью, и её в обычных проектах по мере возможности лучше избегать. Но есть один вариант, когда она (точнее, её концепция) неплохо подходит -- это наличие большого числа оффлайн-клиентов, которые должны продолжать работать, будучи отключенными от интернета. Обычно на каждом клиентском устройстве имеется своя локальная база данных, которая работает как ведущий узел (принимает запросы на запись). Кроме того, периодически выполняется асинхронный процесс репликации (синхронизации) между репликами базы на всех устройствах. Задержка этой репликации может составлять часы или даже дни -- в зависимости от того, когда появится доступ в интернет. Такая схема, по сути, то же самое, что и репликация с несколькими ведущими узлами между ЦОДами, доведенная до крайности: каждое устройство представляет собой условный ЦОД, а сетевое соединение между ними исключительно ненадёжно.

## Репликация с несколькими ведущими узлами

Сегодня очень популярны приложения для совместного редактирования документов в режиме реального времени (real time collaborative editing) -- например, Google Docs. Когда пользователь редактирует документ, изменения немедленно применяются к его локальной реплике (состояние документа в его браузере или клиентском приложении) и асинхронно реплицируются на сервер и на всех остальных пользователей, редактирующих этот же документ.

Проблема 34. Прежде чем пользователь сможет отредактировать документ, приложение должно запросить на этот документ блокировку. Тогда, если другой пользователь хочет отредактировать тот же документ, он должен сначала подождать, пока первый не зафиксирует свои изменения и не снимет блокировку. Такая модель совместной работы эквивалентна репликации с одним ведущим узлом и выполнением транзакций на нём, однако она может создавать большие задержки в работе и неудобство для пользователей.

Решение. Для ускорения совместной работы блок изменений делаем очень маленьким (например, одно нажатие клавиши), и по возможности избегаем блокировок. Такой подход позволяет редактировать нескольким пользователям одновременно один документ достаточно комфортно.


### Репликация с несколькими ведущими узлами (задания)

======= 28. В модели multi-leader replication ...

[ 1] каждый ведущий одновременно работает как ведомый для других ведущих

[ ] каждый ведущий одновременно работает как ведущий для других ведомых

[ ] каждый ведомый одновременно работает как ведущий для других ведомых

[ ] каждый ведомый одновременно работает как ведомый для других ведущих

======= 29. Одни и те же данные могут одновременно модифицироваться в двух различных ЦОДах ...

[ ] репликацию с несколькими ведущими узлами лучше избегать

[ 1] на клиентском устройстве ведём локальную БД, которая работает как ведущий узел

[ ] на клиентском устройстве ведём локальную БД, которая работает как ведомый узел

======= 30. Модель real time collaborative editing эквивалентна ...

[ ] поддержке транзакций на ведомых узлах

[ ] репликации с несколькими ведущими узлами

[1 ] репликации с одним ведущим узлом
