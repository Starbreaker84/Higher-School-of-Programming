## Репликация и секционирование

На первом курсе по теме highload мы изучили способы хранения данных на отдельной машине. Теперь выясним, что произойдёт, если в хранении и обработке данных будут участвовать несколько машин. Это так называемая  **распределённая обработка данных** , или просто  **распределённые данные** . Они востребованы, когда в проекте возникают проблемы с масштабируемостью, отказоустойчивостью, задержкой отклика.

*По материалам учебника
**"Designing Data-Intensive Applications: The Big Ideas Behind Reliable, Scalable, and Maintainable Systems"**
автор  **Martin Kleppmann** .*

Проблема 1. Типичные проблемы highload-проектов: плохая масштабируемость, частые сбои, длительный отклик.

Решение. **Задействовать более мощную машину** -- так называемое **вертикальное масштабирование** (vertical scaling, scaling up). Процессоры, чипы, жёсткие диски объединяются под управлением одной ОС. Любой из процессоров может обращаться к любой части памяти или диска -- **архитектура с разделяемой памятью** (shared-memory architecture), когда множество всех компонентов рассматривается как единая машина.

*Тут сразу возникает тема секционирования, хотя и в другом (аппаратном) контексте.*

Проблема 2. Некоторые банки памяти расположены физически ближе к одним процессорам, чем к другим -- т.н. неоднородный доступ к памяти (nonuniform memory access, NUMA).

Решение. Обработка данных разбивается на составные части так, чтобы процессоры обращались преимущественно к находящейся поблизости памяти. Это и есть так называемое  **секционирование** .

Проблема 3. Стоимость более мощной машины растет нелинейно. Машина с вдвое большим количеством процессоров, вдвое большим количеством памяти и двойным объёмом дисков стоит существенно больше, чем в два раза. Кроме того, мощность машины тоже растёт нелинейно, только в "другую сторону" от цены: вдвое мощная машина совсем не обязательно справится с двойной нагрузкой. Вдобавок проект строго привязывается к одной географической точке, где работает такая машина.

Решение. **Архитектура с разделяемым дисковым накопителем (shared-disk architecture)** использует несколько машин с отдельными процессорами и оперативной памятью, но данные хранятся в массиве дисков, совместно используемом всеми машинами, подключенными к сетевому хранилищу данных (network attached storage, NAS) или в сеть хранения данных (storage area network, SAN).

Проблема 4. Конкуренция за ресурсы и накладные расходы на блокировки в упомянутых архитектурах сильно ограничивают масштабируемость.

Решение.  **Архитектура без разделения ресурсов (shared-nothing architecture) -- горизонтальное масштабирование (horizontal scaling, scaling out)** . Каждый компьютер или виртуальная машина с БД называются  **узел (node)** . Все узлы используют свои процессоры, память и диски независимо друг от друга. Согласование узлов выполняется на уровне программного обеспечения с помощью обычной сети.

В таком случае можно применять общедоступный софт и обычные машины, имеющие наилучшее соотношение "цена/производительность" под конкретный проект. А благодаря облачным сервисам и виртуальным машинам даже маленькие компании могут организовать географически распределенную и хорошо устойчивую архитектуру.

*На данном курсе мы сосредоточимся на архитектурах без разделения ресурсов.*


### Типичные проблемы highload-проектов (задания)

======= 1. Как лучше решать проблемы highload-проектов?

[] вертикальным масштабированием

[1] горизонтальным масштабированием

======= 2. Вертикальное масштабирование -- это ...

[1] задействовать более мощную машину

[ ] использовать независимые друг от друга узлы

======= 3. Горизонтальное масштабирование -- это ...

[ ] задействовать более мощную машину

[1] использовать независимые друг от друга узлы
