## Задержки репликации

Проблема 28. При чтении с асинхронных ведомых узлов, из различных реплик, которые запаздывают по разному (например, когда запросы маршрутизируются к случайным серверам), на клиенте возникает эффект возврата во времени (данные скачут, становятся то более новыми, то более старыми).

Решение. Применяется т.н.  **монотонное чтение записей** , которое почти гарантирует, что подобная аномалия не произойдёт. Это не столь надёжная "гарантия", как сильная согласованность (strong consistency), но более надёжная, нежели конечная согласованность. Монотонное чтение означает только одно: при нескольких операциях чтения подряд клиент не получит скачащих во времени данных -- старые данные гарантированно не будут читаться после новых. Для этого в частности чтение данных всеми пользователями организуется из одной и той же реплики (разные пользователи конечно могут читать из разных реплик).


## Задержки репликации

Проблема 29. При организации, например, онлайн-чата пользователи могут наблюдать эффект нарушения причинно-следственной связи, когда ответы одних участников появляются раньше заданных им вопросов другими участниками.

Решение. **Cогласованное префиксное чтение (consistent prefix reads)** гарантирует, что если операции записи выполняются в определенной последовательности, то в такой же последовательности они и будут прочитаны, для чего данным добавляется префикс, задающий порядок их поступления в базу.


## Задержки репликации

Проблема 30. Реализация cогласованного префиксного чтения особенно сложна в секционированных (подвергнутых шардингу) базах данных, что обсуждается далее. Если БД всегда применяет операции записи в одном и том же порядке, то префикс при чтении всегда будет согласованным. Однако во многих распределённых базах различные секции функционируют независимо, поэтому глобальное упорядочение операций записи реализовать не удаётся.

Решение. Если некоторые операции записи логически связаны друг с другом, то они записываются в одну секцию, хотя эффективно реализовать такую схему крайне сложно. Существуют также алгоритмы явного отслеживания причинно-следственных зависимостей, которые тоже трудны в продуктивной реализации.


### Задержки репликации (задания)

======= 25. Монотонное чтение записей -- это когда ...

[] данные становятся то более новыми, то более старыми

[ ] данные сильно согласованы

[1] старые данные не будут читаться после новых

======= 26. Cогласованное префиксное чтение -- это когда ...

[1 ] добавляем данным префикс, задающий порядок их поступления

[ ] записываем данные в одну секцию

[ ] явно отслеживаем причинно-следственные зависимости

[ ] применяем операции записи в одном и том же порядке

======= 27. Из-за разного запаздывания узлов возникает эффект нарушения причинно-следственной связи. Выберите ошибочное решение.

[ ] явно отслеживаем причинно-следственные зависимости

[ 1] применяем операции записи в одном и том же порядке

[ ] добавляем данным префикс, задающий порядок их поступления

[ ] записываем данные в одну секцию
